# Project Plan: CLI Options for Testing & File Input

## Goal
Enable automated testing and reproducible runs by adding CLI options to preserve temporary files and inject audio input.

## Steps

1.  **Update CLI Entry Point (`src/cli/run.py`)**
    *   Add `--keep-files` (boolean) and `--file` (string) to `argparse`.
    *   Pass these values into `ConfigurationManager` (or directly update the `config` object).
    *   Modify the `finally` block to condition `recorder.cleanup_temp_files()` on `not config['keep_files']`.

2.  **Update Mode Logic (`src/second_voice/modes/`)**
    *   **`base.py`**:
        *   Modify `cleanup()` to check `self.config.get('keep_files')` before deleting files in `mode_tmp`.
    *   **`tui_mode.py`**:
        *   Modify `run()` loop.
        *   Check for `self.config.get('input_file')`.
        *   If present and not yet processed: use it as `audio_path`, set a flag `_file_processed`, and skip recording.
        *   Ensure the provided input file is *not* deleted in the per-loop cleanup (check if path matches `input_file` before unlink, or rely on `keep_files`? Better to explicitly protect the input file even if `keep_files` is false, as we shouldn't delete user data).
        *   Respect `keep_files` for generated temp files.
    *   **`menu_mode.py`**:
        *   Modify `run()` to auto-trigger the processing logic if `input_file` is present.
        *   Respect `keep_files`.

3.  **Update Documentation (`README.md`)**
    *   Add "Testing" section.
    *   Explain `scripts/demo_second_voice.py` usage.
    *   Explain `--keep-files` and `--file` usage.

4.  **Verification**
    *   Test `python src/cli/run.py --file samples/test.wav` (ensure `test.wav` exists or create a dummy one).
    *   Test `python src/cli/run.py --keep-files`.

## Risks
-   Deleting the user's input file: Must ensure the unlink logic explicitly excludes the `input_file` path.
-   Mode inconsistency: GUI mode might not support `--file` easily; this is acceptable but should be noted.

## Deliverables
-   Modified `src/cli/run.py`
-   Modified `src/second_voice/modes/base.py`, `tui_mode.py`, `menu_mode.py`
-   Updated `README.md`
