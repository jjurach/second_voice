# Project Plan: Simple Mandatory Reading Lists for Agent Files

**Created:** 2026-01-28
**Status:** Draft
**Related Spec:** `dev_notes/specs/2026-01-28_10-36-41_mandatory-context-assembly.md`
**Supersedes:** `dev_notes/project_plans/2026-01-28_10-36-41_mandatory-context-assembly.md` (WONT-DO)

---

## Overview

**IMPORTANT:** This plan has been updated to reflect that CLAUDE.md, AIDER.md, etc. are **generated by bootstrap.py** from anemic templates and should remain ~20 lines (navigation only).

Instead, we'll update:
1. **AGENTS.md** via bootstrap.py section injection (add mandatory reading section)
2. **Tool-specific guides** in `docs/system-prompts/tools/` (emphasize mandatory reading at top)
3. **docs/mandatory.md** (create project-specific guidelines)

**Why this approach:**
- Respects the anemic entry point architecture (CLAUDE.md stays 20 lines)
- Uses existing bootstrap.py section management
- No conflict with generated files
- Clear and transparent
- Easy to maintain
- Solves the actual problem (ensuring agents read mandatory content)

---

## Current State

**Entry points (generated by bootstrap.py):**
- `CLAUDE.md`, `AIDER.md`, `CLINE.md`, `GEMINI.md` - Anemic 20-line navigation files
- Generated from templates in `bootstrap.py` `get_tool_entry_point_template()`
- Currently reference AGENTS.md and tool guides, but without strong "MUST READ" emphasis

**Core files:**
- `AGENTS.md` - Core workflow, managed via sections by bootstrap.py
- `docs/system-prompts/tools/claude-code.md` - Comprehensive Claude guide (~600+ lines)
- `docs/system-prompts/tools/aider.md` - Comprehensive Aider guide
- Similar guides for other tools

**Current approach:** Entry points say "Read First: AGENTS.md" but don't emphasize it as MANDATORY or list other required reading.

---

## Goals

1. **Clarity:** Make it crystal clear which files are mandatory vs. optional
2. **Consistency:** Use same pattern across all agent files
3. **Simplicity:** No build steps, no complexity
4. **Effectiveness:** Ensure agents actually read mandatory content at session start

---

## Implementation Plan

### Phase 1: Identify Mandatory Content (15 minutes)

**Goal:** Determine which files all agents must read.

**Tasks:**

1. **List core mandatory files:**
   - `docs/system-prompts/workflows/logs-first.md` - Core workflow
   - `docs/system-prompts/principles/definition-of-done.md` - Quality standards (if exists)
   - `docs/definition-of-done.md` - Quality standards (alternate location)
   - `docs/mandatory.md` - Project-specific rules (create if doesn't exist)

2. **Verify files exist:**
   ```bash
   ls -la docs/system-prompts/workflows/logs-first.md
   ls -la docs/system-prompts/principles/definition-of-done.md
   ls -la docs/definition-of-done.md
   ls -la docs/mandatory.md
   ```

3. **Identify agent-specific files:**
   - For Claude: `docs/system-prompts/tools/claude-code.md`
   - For Aider: `docs/system-prompts/tools/aider.md`
   - For Gemini: `docs/system-prompts/tools/gemini.md`
   - Others as they exist

**Deliverable:** List of mandatory files (common + agent-specific)

---

### Phase 2: Create docs/mandatory.md (10 minutes)

**Goal:** Create project-specific mandatory content file.

**Tasks:**

1. **Create `docs/mandatory.md`:**

```markdown
# Second Voice: Project-Specific Mandatory Instructions

This file contains mandatory instructions specific to the Second Voice project.

## Project Structure

Second Voice is a voice-to-text processing tool with AI integration.

**Key directories:**
- `src/second_voice/` - Main source code
  - `core/` - Configuration, modes, and core functionality
  - `providers/` - AI provider integrations (OpenRouter, Google, OpenAI)
  - `cli/` - Command-line interface
- `tests/` - Unit tests
- `docs/` - Documentation
- `dev_notes/` - Development logs and planning

## Key Documentation

**MUST READ for context on specific topics:**
- `docs/architecture.md` - System architecture and design
- `docs/implementation-reference.md` - Implementation patterns
- `docs/workflows.md` - Development workflows

**For understanding the codebase:**
- `README.md` - Project overview and quick start
- `config.example.json` - Configuration options

## Development Guidelines

- **Python version:** 3.8+
- **Dependencies:** Manage in both `requirements.txt` AND `pyproject.toml`
- **Testing:** Use pytest, aim for 60%+ coverage on critical paths
- **Configuration:** Never hardcode secrets, use `config.json` or env vars

## Prohibited Actions

- Do NOT edit files in `docs/system-prompts/` unless explicitly instructed
- Do NOT refactor code unless it's part of the stated task
- Do NOT add features beyond what's requested
- Do NOT use `/tmp` for temporary files (use current directory with `tmp-*` pattern)

## When You're Unsure

**STOP and ask the user** rather than making assumptions about:
- Architecture changes
- New dependencies
- Breaking changes to existing APIs
- Security-sensitive code
```

2. **Adjust content** based on actual project needs

**Deliverable:** `docs/mandatory.md` created

---

### Phase 3: Create MANDATORY-READING Section for AGENTS.md (20 minutes)

**Goal:** Create a new section that bootstrap.py can inject into AGENTS.md with mandatory reading list.

**IMPORTANT:** AGENTS.md is managed by bootstrap.py via section injection. We need to:
1. Create a new markdown file in `docs/system-prompts/` for the mandatory reading content
2. Update bootstrap.py to inject this as a section into AGENTS.md

**Tasks:**

1. **Create `docs/system-prompts/mandatory-reading.md`:**

```markdown
# Claude Code Instructions

## MANDATORY READING - READ FIRST, EVERY SESSION

**CRITICAL:** Before starting ANY task, you MUST read these files in this exact order:

1. **Core Workflow:** [docs/system-prompts/workflows/logs-first.md](docs/system-prompts/workflows/logs-first.md)
   - Defines how to approach all tasks (Spec → Plan → Implement → Document)
   - Contains file naming conventions and status definitions

2. **Definition of Done:** [docs/definition-of-done.md](docs/definition-of-done.md)
   - Quality standards and completion criteria
   - Verification requirements

3. **Claude-Specific Guide:** [docs/system-prompts/tools/claude-code.md](docs/system-prompts/tools/claude-code.md)
   - Claude Code specific features and best practices

4. **Project Guidelines:** [docs/mandatory.md](docs/mandatory.md)
   - Second Voice specific rules and structure
   - Prohibited actions

**Why these files are mandatory:**
- They define how to work in this codebase
- They prevent common mistakes
- They ensure quality and consistency

---

## Optional Resources (Read as Needed)

These files provide additional context when working on specific features:

- **Architecture:** [docs/architecture.md](docs/architecture.md) - System design
- **Implementation Reference:** [docs/implementation-reference.md](docs/implementation-reference.md) - Code patterns
- **Workflows:** [docs/workflows.md](docs/workflows.md) - Development processes

---

## Quick Reference

- **Project:** Voice-to-text with AI processing
- **Language:** Python 3.8+
- **Testing:** pytest with mocked external services
- **Config:** Use `config.json`, see `config.example.json` for schema

---

**Last Updated:** 2026-01-28
```

3. **Test with actual file paths:**
   - Verify all referenced files exist
   - Adjust paths if needed

**Deliverable:** Updated `CLAUDE.md`

---

### Phase 4: Update AGENTS.md (10 minutes)

**Goal:** Update generic agent instructions with mandatory reading list.

**Tasks:**

1. **Read current AGENTS.md:**
   ```bash
   cat AGENTS.md
   ```

2. **Add mandatory reading section** (if not already present):

```markdown
# Agent Instructions

## MANDATORY READING - READ FIRST, EVERY SESSION

**CRITICAL:** Before starting ANY task, you MUST read these files in this exact order:

1. **Core Workflow:** [docs/system-prompts/workflows/logs-first.md](docs/system-prompts/workflows/logs-first.md)
2. **Definition of Done:** [docs/definition-of-done.md](docs/definition-of-done.md)
3. **Project Guidelines:** [docs/mandatory.md](docs/mandatory.md)

[Rest of AGENTS.md content...]
```

3. **Verify bootstrap.py sections:**
   - Check if AGENTS.md has sections managed by bootstrap.py
   - Ensure new content doesn't conflict with managed sections
   - Place mandatory reading BEFORE any managed sections

**Deliverable:** Updated `AGENTS.md`

---

### Phase 5: Create Other Agent Files (Optional, 15 minutes)

**Goal:** Create or update agent files for other tools if they exist in the project.

**Tasks:**

1. **Check for existing agent files:**
   ```bash
   ls -la *.md | grep -E "(aider|gemini|cursor|cody|copilot)\.md"
   ```

2. **For each agent file found, apply same pattern:**

**Example for aider.md:**
```markdown
# Aider Instructions

## MANDATORY READING - READ FIRST, EVERY SESSION

Before starting ANY task, you MUST read these files in order:

1. **Core Workflow:** [docs/system-prompts/workflows/logs-first.md](docs/system-prompts/workflows/logs-first.md)
2. **Definition of Done:** [docs/definition-of-done.md](docs/definition-of-done.md)
3. **Aider-Specific Guide:** [docs/system-prompts/tools/aider.md](docs/system-prompts/tools/aider.md)
4. **Project Guidelines:** [docs/mandatory.md](docs/mandatory.md)

## Optional Resources
- Architecture: [docs/architecture.md](docs/architecture.md)
- Implementation: [docs/implementation-reference.md](docs/implementation-reference.md)
```

**Deliverable:** All agent files updated with consistent pattern

---

### Phase 6: Verification & Testing (10 minutes)

**Goal:** Verify all files exist and links work.

**Tasks:**

1. **Verify all referenced files exist:**
   ```bash
   # Check each file referenced in mandatory reading lists
   for file in \
     docs/system-prompts/workflows/logs-first.md \
     docs/definition-of-done.md \
     docs/mandatory.md \
     docs/system-prompts/tools/claude-code.md \
     docs/system-prompts/tools/aider.md \
     docs/architecture.md \
     docs/implementation-reference.md \
     docs/workflows.md; do
     if [ -f "$file" ]; then
       echo "✓ $file"
     else
       echo "✗ MISSING: $file"
     fi
   done
   ```

2. **Create missing files** (if any):
   - Use placeholder content if file is referenced but doesn't exist
   - Mark as TODO for future completion

3. **Test with fresh Claude session** (manual):
   - Start new Claude Code session
   - Observe if it reads the mandatory files
   - Verify it doesn't skip any
   - Count tool calls required

**Deliverable:** All files verified, missing files created or removed from lists

---

## Files to Create/Modify

### Created
- `docs/mandatory.md` - Project-specific mandatory instructions

### Modified
- `CLAUDE.md` - Add mandatory reading section
- `AGENTS.md` - Add mandatory reading section
- `aider.md` - Add mandatory reading section (if exists)
- `gemini.md` - Add mandatory reading section (if exists)
- Other agent files as they exist

### Not Modified
- Source code (no code changes)
- System prompts (read only, not modified)
- Tests (no changes needed)

---

## Success Criteria

✅ All agent files have clear "MANDATORY READING" sections
✅ All referenced files exist or have been removed from lists
✅ Consistent pattern across all agent files
✅ `docs/mandatory.md` created with project guidelines
✅ Verification shows all files accessible
✅ No build steps or generated files required
✅ Clear distinction between mandatory and optional resources

---

## Risk Assessment

**Low Risk:**
- Simple text file updates
- No code changes
- No build steps
- Easy to verify
- Easy to rollback if needed

**Potential Issues:**
- Files referenced may not exist → Mitigation: Verify in Phase 6
- Agents may still not read them → Mitigation: Test in real session, iterate on language
- Paths may be wrong → Mitigation: Use relative paths, test links

---

## Estimated Effort

- Phase 1: 15 minutes (identify files)
- Phase 2: 10 minutes (create docs/mandatory.md)
- Phase 3: 10 minutes (update CLAUDE.md)
- Phase 4: 10 minutes (update AGENTS.md)
- Phase 5: 15 minutes (other agent files)
- Phase 6: 10 minutes (verification)

**Total: ~70 minutes (1-1.5 hours)**

---

## Testing Plan

### Immediate Testing
1. Verify all file paths are correct
2. Check that files exist
3. Read each mandatory file to ensure quality

### Real-World Testing (1-2 weeks)
1. Use updated agent files in actual development
2. Monitor whether agents read mandatory content
3. Observe if 3-5 tool calls causes any issues
4. Collect feedback on clarity and effectiveness

### Success Metrics
- Agents read all mandatory files without prompting
- No instances of agents missing mandatory content
- Development workflow feels smooth
- No complaints about tool call overhead

---

## Future Enhancements (If Needed)

Only consider if real-world testing reveals problems:

1. **Add emphasis markers:** Use UPPERCASE, bold, emojis to draw attention
2. **Reduce list:** If 3-5 files is too many, consolidate
3. **Add verification:** Agents could confirm they read files
4. **Consider assembly:** Only if simple approach demonstrably fails

**Decision gate:** Don't implement any enhancements until we have evidence they're needed.

---

## Rollback Plan

If this approach doesn't work:

1. **Evidence needed:**
   - Agents skipping mandatory files (documented instances)
   - Problems caused by skipped content (actual issues)
   - 3-5 tool calls causing measurable problems

2. **Alternative approaches:**
   - **Try 1:** Make language more emphatic
   - **Try 2:** Reduce number of mandatory files
   - **Try 3:** Only then consider assembly system (WONT-DO plan)

---

## Notes

- This is the **simplest possible solution** that could work
- Prefer this over complex assembly machinery
- Test with real usage before adding complexity
- "The best code is the code you don't have to write"

---

## Appendix: Template for New Agent Files

When adding support for a new AI coding assistant:

```markdown
# [Agent Name] Instructions

## MANDATORY READING - READ FIRST, EVERY SESSION

Before starting ANY task, you MUST read these files in order:

1. **Core Workflow:** [docs/system-prompts/workflows/logs-first.md](docs/system-prompts/workflows/logs-first.md)
2. **Definition of Done:** [docs/definition-of-done.md](docs/definition-of-done.md)
3. **[Agent]-Specific Guide:** [docs/system-prompts/tools/[agent].md](docs/system-prompts/tools/[agent].md) (if exists)
4. **Project Guidelines:** [docs/mandatory.md](docs/mandatory.md)

## Optional Resources
- Architecture: [docs/architecture.md](docs/architecture.md)
- Implementation: [docs/implementation-reference.md](docs/implementation-reference.md)
- Workflows: [docs/workflows.md](docs/workflows.md)

---

[Agent-specific content here]
```

---
